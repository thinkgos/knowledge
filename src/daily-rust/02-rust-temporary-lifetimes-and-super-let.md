# (è¯‘)`Rust`ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸå’Œ"Super Let"[^1]

åœ¨`Rust`ä¸­, ä¸´æ—¶å˜é‡ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€ä¸ªå¤æ‚ä½†åˆç»å¸¸è¢«å¿½è§†çš„è¯é¢˜. åœ¨ä¸€äº›ç®€å•çš„æƒ…å†µä¸‹, `Rust`ä¼šè®©ä¸´æ—¶å˜é‡å­˜æ´»è¶³å¤Ÿé•¿çš„æ—¶é—´, è¿™æ ·æˆ‘ä»¬å°±ä¸å¿…è€ƒè™‘å®ƒä»¬äº†. ç„¶è€Œ, åœ¨å¾ˆå¤šæƒ…å†µä¸‹, æˆ‘ä»¬å¯èƒ½æ— æ³•ç«‹å³å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿.

åœ¨è¿™ç¯‡æ–‡ç« ä¸­, æˆ‘ä»¬å°†(é‡æ–°)å‘æ˜ä¸´æ—¶å˜é‡ç”Ÿå‘½å‘¨æœŸçš„è§„åˆ™, ä»‹ç»ä¸€äº›ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•çš„ç”¨ä¾‹, å¹¶æ¢ç´¢ä¸€ç§æ–°çš„è¯­è¨€ç†å¿µ--`super let,`, ä¸ºæˆ‘ä»¬æä¾›æ›´å¤šæ§åˆ¶.

## ä¸´æ—¶å˜é‡

ä¸‹é¢æ˜¯ä¸€æ¡`Rust`è¯­å¥, æ²¡æœ‰ä¸Šä¸‹æ–‡, ä½¿ç”¨çš„æ˜¯ä¸´æ—¶`String`:

```rust
f(&String::from('ğŸ¦€'));
```

è¿™ä¸ªä¸´æ—¶`String`çš„å­˜æ´»æ—¶é—´å¤šé•¿?å¦‚æœæˆ‘ä»¬ä»Šå¤©è®¾è®¡`Rust`, åŸºæœ¬ä¸Šæœ‰ä¸¤ç§é€‰æ‹©:

1. åœ¨è°ƒç”¨ `f` ä¹‹å‰, å­—ç¬¦ä¸²ä¼šè¢«ç«‹å³ä¸¢å¼ƒ. æˆ–è€…
2. åªæœ‰åœ¨è°ƒç”¨ `f` å, å­—ç¬¦ä¸²æ‰ä¼šè¢«ä¸¢å¼ƒ.

å¦‚æœæˆ‘ä»¬é€‰æ‹©æ–¹æ¡ˆ**1**, é‚£ä¹ˆä¸Šé¢çš„è¯­å¥å°†å§‹ç»ˆå¯¼è‡´å€Ÿç”¨æ£€æŸ¥é”™è¯¯, å› ä¸ºæˆ‘ä»¬ä¸èƒ½è®©`f`å€Ÿç”¨å·²ç»æ¶ˆå¤±çš„ä¸œè¥¿.
å› æ­¤, `Rust`é€‰æ‹©äº†æ–¹æ¡ˆ**2**: é¦–å…ˆåˆ†é…å­—ç¬¦ä¸², ç„¶åå°†å…¶å¼•ç”¨ä¼ é€’ç»™`f`, åªæœ‰åœ¨`f`è¿”å›å, æˆ‘ä»¬æ‰ä¼šä¸¢å¼ƒä¸´æ—¶å­—ç¬¦ä¸².

### åœ¨ä¸€ä¸ª `let` è¯­å¥ä¸­

ç°åœ¨æ˜¯ä¸€ä¸ªç¨éš¾çš„é—®é¢˜:

```rust
let a = f(&String::from('ğŸ¦€'));
â€¦
g(&a);
```

å†æ¥: è¿™ä¸ªä¸´æ—¶`String`çš„å­˜æ´»æ—¶é—´å¤šé•¿?

1. å­—ç¬¦ä¸²ä¼šåœ¨ `let` è¯­å¥ç»“æŸæ—¶ä¸¢å¼ƒ: å³åœ¨`f`è¿”å›ä¹‹å, ä½†åœ¨`g`è¢«è°ƒç”¨ä¹‹å‰. æˆ–è€…
2. å­—ç¬¦ä¸²ä¼šåœ¨è°ƒç”¨`g`ä¹‹åçš„åŒæ—¶`a`è¢«ä¸¢å¼ƒ.

å¦‚æœ`f`è¢«å®šä¹‰ä¸º `fn f(s: &str) -> usize`(å¦‚`str::len`), é‚£ä¹ˆåœ¨`let`è¯­å¥åç«‹å³å»æ‰`String`å°±å®Œå…¨æ²¡é—®é¢˜äº†.

ä½†æ˜¯, å¦‚æœ`f`è¢«å®šä¹‰ä¸º `fn f(s: &str) -> &[u8]`(å°±åƒ `str::as_bytes`), é‚£ä¹ˆ `a` å°±ä¼šä»ä¸´æ—¶å˜é‡ `String` ä¸­å€Ÿç”¨, å› æ­¤å¦‚æœæˆ‘ä»¬å°†`a`ä¿ç•™è¾ƒé•¿æ—¶é—´, å°±ä¼šå‡ºç°å€Ÿç”¨æ£€æŸ¥é”™è¯¯.

å¦‚æœé‡‡ç”¨æ–¹æ¡ˆ**2**, åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸ç¼–è¯‘, ä½†æˆ‘ä»¬å¯èƒ½ä¼šåœ¨è¶…å‡ºå¿…è¦çš„å­˜æ´»æ—¶é—´å†…ä¿ç•™ä¸€ä¸ªä¸´æ—¶å˜é‡, è¿™å¯èƒ½ä¼šæµªè´¹èµ„æºæˆ–å¯¼è‡´å¾®å¦™çš„é”™è¯¯(ä¾‹å¦‚, å½“`MutexGuard`æ¯”é¢„æœŸæ—¶é—´æ™šä¸¢å¼ƒæ—¶ä¼šé€ æˆæ­»é”).

è¿™å¬èµ·æ¥åƒæ˜¯ç¬¬**3**ç§é€‰æ‹©: è®©å®ƒå–å†³äº`f`çš„ç­¾å.

ä½†æ˜¯, `Rust`çš„å€Ÿç”¨æ£€æŸ¥å™¨åªæ‰§è¡Œæ£€æŸ¥, å¹¶ä¸å½±å“ä»£ç çš„è¡Œä¸º. å‡ºäºå„ç§åŸå› , è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦å’Œæœ‰ç”¨çš„å±æ€§. ä¸¾ä¾‹æ¥è¯´, å°† `fn f(s:&str)->&[u8]`(è¿”å›å€¼å€Ÿç”¨å‚æ•°)æ”¹ä¸º `fn f(s:&str)->&'static[u8]`(è¿”å›å€¼ä¸å€Ÿç”¨å‚æ•°)å¹¶ä¸ä¼šæ”¹å˜è°ƒç”¨ä½ç½®çš„ä»»ä½•å†…å®¹, ä¾‹å¦‚ä¸´æ—¶å˜é‡è¢«ä¸¢å¼ƒçš„ä½ç½®.

å› æ­¤, åœ¨æ–¹æ¡ˆ**1**å’Œæ–¹æ¡ˆ**2**ä¹‹é—´, `Rust`é€‰æ‹©äº†æ–¹æ¡ˆ**1**: åœ¨`let`è¯­å¥æœ«å°¾åˆ é™¤ä¸´æ—¶å˜é‡. å¾ˆå®¹æ˜“æ‰‹åŠ¨å°†`String`ç§»åˆ°å•ç‹¬çš„`let`è¯­å¥ä¸­, è®©å®ƒä¿æŒæ›´é•¿çš„æ—¶é—´.

```rust
let s = String::from('ğŸ¦€'); // Moved to its own `let` to give it a longer lifetime.
let a = f(&s);
â€¦
g(&a);
```

### åœ¨åµŒå¥—è°ƒç”¨ä¸­

å¥½å§, å†æ¥ä¸€ä¸ª:

```rust
g(f(&String::from('ğŸ¦€')));
```

åŒæ ·, æœ‰ä¸¤ç§é€‰æ‹©:

1. åœ¨è°ƒç”¨`f`ä¹‹åã€è°ƒç”¨`g`ä¹‹å‰, å­—ç¬¦ä¸²è¢«ä¸¢å¼ƒ. æˆ–è€…
2. å­—ç¬¦ä¸²ä¼šåœ¨è¯­å¥ç»“æŸæ—¶ä¸¢å¼ƒ, æ‰€ä»¥æ˜¯åœ¨è°ƒç”¨`g`ä¹‹å.

è¯¥ä»£ç æ®µä¸å‰ä¸€ä¸ªä»£ç æ®µå‡ ä¹å®Œå…¨ç›¸åŒ: ä¸´æ—¶`String`çš„å¼•ç”¨è¢«ä¼ é€’ç»™`f`, `f`çš„è¿”å›å€¼è¢«ä¼ é€’ç»™`g`.

ä¸è¿‡, æ–¹æ¡ˆ**1**å¯èƒ½æœ‰æ•ˆ, ä¹Ÿå¯èƒ½æ— æ•ˆ, è¿™å–å†³äº`f`çš„ç­¾å, è€Œæ–¹æ¡ˆ**2**å¯èƒ½ä¼šè®©ä¸´æ—¶å˜é‡å­˜æ´»æ›´é•¿çš„æ—¶é—´.

ä¸è¿‡, è¿™æ¬¡æ–¹æ¡ˆ**1**ä¼šç»™ç¨‹åºå‘˜å¸¦æ¥æ›´å¤šæƒŠå–œ. ä¾‹å¦‚, å³ä½¿æ˜¯ç®€å•çš„ `String::from('ğŸ¦€').as_bytes().contains(&0x80)` ä¹Ÿæ— æ³•ç¼–è¯‘, å› ä¸ºå­—ç¬¦ä¸²ä¼šåœ¨ `as_bytes(f)` ä¹‹åã€`contains (g)` ä¹‹å‰è¢«åˆ é™¤.

ä¹Ÿå¯ä»¥è¯´, æŠŠä¸´æ—¶å˜é‡å¤šå­˜æ´»ä¸€æ®µæ—¶é—´çš„åå¤„è¦å°å¾—å¤š, å› ä¸ºä»–ä»¬åœ¨å£°æ˜ç»“æŸæ—¶ä»ç„¶ä¼šè¢«ä¸¢å¼ƒ.

å› æ­¤, Rusté€‰æ‹©äº†æ–¹æ¡ˆ**2**: æ— è®º`f`çš„ç­¾åå¦‚ä½•, å­—ç¬¦ä¸²éƒ½ä¼šä¸€ç›´å­˜åœ¨, ç›´åˆ°è¯­å¥ç»“æŸ, ç›´åˆ°`g`è¢«è°ƒç”¨.

### åœ¨ä¸€ä¸ª `if` è¯­å¥ä¸­

ç°åœ¨, æˆ‘ä»¬æ¥çœ‹çœ‹ç®€å•çš„ `if` è¯­å¥:

```rust
if f(&String::from('ğŸ¦€')) {
    â€¦
}
```

åŒæ ·çš„é—®é¢˜: `String` ä½•æ—¶ä¸¢å¼ƒ?

1. åœ¨ `if` çš„æ¡ä»¶æ±‚å€¼ä¹‹å, ä½†åœ¨ `if` çš„ä¸»ä½“æ‰§è¡Œä¹‹å‰(å³åœ¨`{`å¤„). æˆ–è€…
2. åœ¨ `if` ä¸»ä½“æ‰§è¡Œä¹‹å(å³åœ¨`}`å¤„).

åœ¨è¿™ç§æƒ…å†µä¸‹, å°±æ²¡æœ‰ç†ç”±åœ¨`if`ä¸»ä½“ä¸­ä¿ç•™ä¸´æ—¶å€¼. æ¡ä»¶çš„ç»“æœæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼(åªæœ‰`true`æˆ–`false`), é¡¾åæ€ä¹‰, è¿™å¹¶ä¸å€Ÿç”¨ä»»ä½•ä¸œè¥¿.

å› æ­¤, `Rust`é€‰æ‹©æ–¹æ¡ˆ**1**.

ä¾‹å¦‚, åœ¨ä½¿ç”¨ `Mutex::lock` æ—¶, å®ƒå°±ä¼šè¿”å›ä¸€ä¸ªä¸´æ—¶`MutexGuard`, å½“`Mutex`è¢«ä¸¢å¼ƒæ—¶, å®ƒå°±ä¼šè§£é”:

```rust
fn example(m: &Mutex<String>) {
    if m.lock().unwrap().is_empty() {
        println!("the string is empty!");
    }
}
```

åœ¨è¿™é‡Œ, `m.lock().unwrap()`ä¸­çš„ä¸´æ—¶`MutexGuard`ä¼šåœ¨`.is_empty()`ä¹‹åä¸¢å¼ƒ, è¿™æ ·`Mutex`å°±ä¸ä¼šåœ¨`println`è¯­å¥ä¸­è¢«ä¸å¿…è¦åœ°é”å®š.

### åœ¨ `if let` è¯­å¥ä¸­

ä½† `if let`(å’Œ `match`)çš„æƒ…å†µæœ‰æ‰€ä¸åŒ, å› ä¸ºæ­¤æ—¶æˆ‘ä»¬çš„è¡¨è¾¾å¼å¹¶ä¸ä¸€å®šæ˜¯è¯„ä¼°å¸ƒå°”å€¼:

```rust
if let â€¦ = f(&String::from('ğŸ¦€')) {
    â€¦
}
```

å†æ¬¡, æœ‰ä¸¤ç§é€‰æ‹©:

1. åœ¨æ¨¡å¼åŒ¹é…ä¹‹åã€`if let` çš„æ­£æ–‡ä¹‹å‰(å³ `{` å¤„)åˆ é™¤å­—ç¬¦ä¸². æˆ–è€…ã€
2. åœ¨ `if let` ä¸»ä½“ä¹‹å(å³ `}` å¤„)åˆ é™¤å­—ç¬¦ä¸².

è¿™ä¸€æ¬¡, æˆ‘ä»¬æœ‰ç†ç”±é€‰æ‹©æ–¹æ¡ˆ**2**è€Œä¸æ˜¯æ–¹æ¡ˆ**1**, åœ¨`if let`è¯­å¥æˆ–`match`ä¸­å€Ÿç”¨æ¨¡å¼æ˜¯å¾ˆå¸¸è§çš„.

å› æ­¤, åœ¨è¿™ç§æƒ…å†µä¸‹, Rusté€‰æ‹©äº†æ–¹æ¡ˆ**2**.

ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª`Mutex<Vec<T>>`ç±»å‹çš„`vec`, ç¼–è¯‘èµ·æ¥å°±å¾ˆå¥½:

```rust
if let Some(x) = vec.lock().unwrap().first() {
    // The mutex is still locked here. :)
    // This is necessary, because we're borrowing `x` from the `Vec`. (`x` is a `&T`)
    println!("first item in vec: {x}");
}
```

æˆ‘ä»¬ä»`m.lock().unwrap()`è·å¾—ä¸€ä¸ªä¸´æ—¶çš„`MutexGuard`, å¹¶ä½¿ç”¨`.first()`æ–¹æ³•å€Ÿç”¨ç¬¬ä¸€ä¸ªå…ƒç´ . ç”±äº`MutexGuard`åªåœ¨æœ€åä¸€ä¸ª `}`æ‰è¢«ä¸¢å¼ƒ, å› æ­¤å€Ÿç”¨å°†æŒç»­æ•´ä¸ª`if let`ä¸»ä½“.

ä¸è¿‡, åœ¨æœ‰äº›æƒ…å†µä¸‹, è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„. ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬ä½¿ç”¨`pop`ä»£æ›¿`first`, å®ƒè¿”å›çš„æ˜¯å€¼è€Œä¸æ˜¯å¼•ç”¨:

```rust
if let Some(x) = vec.lock().unwrap().pop() {
    // The mutex is still locked here. :(
    // This is unnecessary, because we don't borrow anything from the `Vec`. (`x` is a `T`)
    println!("popped item from the vec: {x}");
}
```

è¿™å¯èƒ½ä¼š[ä»¤äººæƒŠè®¶](https://marabos.nl/atomics/basics.html#lifetime-of-mutexguard), å¹¶å¯¼è‡´å¾®å¦™çš„é”™è¯¯æˆ–æ€§èƒ½é™ä½.

ä¹Ÿè®¸è¿™å°±æ˜¯`Rust`é€‰æ‹©é”™è¯¯æ–¹æ¡ˆçš„ä¸€ä¸ªè®ºæ®, ä¹Ÿè®¸è¿™å°±æ˜¯åœ¨æœªæ¥ç‰ˆæœ¬çš„`Rust`ä¸­æ”¹å˜è¿™ä¸€è§„åˆ™çš„ä¸€ä¸ªè®ºæ®. å…³äºå¦‚ä½•ä¿®æ”¹è¿™äº›è§„åˆ™çš„æƒ³æ³•, è¯·å‚é˜… [Nikoâ€™s blog post on this topic](https://smallcultfollowing.com/babysteps/blog/2023/03/15/temporary-lifetimes/).

ç›®å‰, è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„`let` è¯­å¥, å°†ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸé™åˆ¶åœ¨è¯¥è¯­å¥ä¸­:

```rust
let x = vec.lock().unwrap().pop(); // The MutexGuard is dropped after this statement.
if let Some(x) = x {
    â€¦
}
```

## ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•

è¿™ç§æƒ…å†µå¦‚ä½•?

```rust
let a = &String::from('ğŸ¦€');
â€¦
f(&a);
```

ä¸¤ç§é€‰æ‹©:

1. å­—ç¬¦ä¸²ä¼šåœ¨ `let` è¯­å¥çš„æœ«å°¾è¢«ä¸¢å¼ƒ. æˆ–è€…
2. åœ¨è°ƒç”¨ `f` å, å­—ç¬¦ä¸²ä¸ `a` åŒæ—¶è¢«åˆ é™¤.

æ–¹æ¡ˆ**1** æ€»æ˜¯ä¼šå¯¼è‡´å€Ÿç”¨æ£€æŸ¥é”™è¯¯. å› æ­¤, æ–¹æ¡ˆ**2**å¯èƒ½æ›´æœ‰æ„ä¹‰. å¦‚ä»Š`Rust`ä¹Ÿç¡®å®æ˜¯è¿™æ ·å·¥ä½œçš„: ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸè¢«æ‰©å±•äº†, å› æ­¤ä¸Šé¢çš„ä»£ç æ®µå¯ä»¥æ­£å¸¸ç¼–è¯‘.

è¿™ç§ä¸´æ—¶å˜é‡ç”Ÿå‘½å‘¨æœŸé•¿äºå®ƒåœ¨å£°æ˜ä¸­å‡ºç°çš„æ—¶é—´çš„ç°è±¡è¢«ç§°ä¸º**ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•**.

ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•å¹¶ä¸é€‚ç”¨äº***æ‰€æœ‰***å‡ºç°åœ¨`let`è¯­å¥ä¸­çš„ä¸´æ—¶å­—ç¬¦ä¸², æ­£å¦‚æˆ‘ä»¬å·²ç»çœ‹åˆ°çš„é‚£æ ·: `let a = f(&String::from('ğŸ¦€'))`; ä¸­çš„ä¸´æ—¶å­—ç¬¦ä¸²ä¸ä¼šè¶…è¿‡ `let`è¯­å¥çš„ç”Ÿå‘½å‘¨æœŸ.

åœ¨`let a = &f(&String::from('ğŸ¦€'))`;(æ³¨æ„å¤šå‡ºçš„ `&`)ä¸­, ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•ç¡®å®é€‚ç”¨äºæœ€å¤–å±‚çš„`&`, å®ƒå€Ÿç”¨äº†ä½œä¸º`f` è¿”å›å€¼çš„ä¸´æ—¶, ä½†ä¸é€‚ç”¨äºå†…å±‚çš„`&`, å®ƒå€Ÿç”¨äº†`String`.

ä¾‹å¦‚, ç”¨`str::len` ä»£æ›¿`f`:

```rust
let a: &usize = &String::from('a').len();
```

åœ¨è¿™é‡Œ, å­—ç¬¦ä¸²åœ¨ `let` è¯­å¥çš„æœ«å°¾è¢«åˆ é™¤, ä½† `.len()`è¿”å›çš„`usize`å’Œ`a`æ´»çš„ä¸€æ ·é•¿.

è¿™ä¸ä»…é™äº `let _ = &...;` è¯­æ³•. ä¾‹å¦‚

```rust
let a = Person {
    name: &String::from('ğŸ¦€'), // Extended!
    address: &String::from('ğŸ¦€'), // Extended!
};
```

åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­, ä¸´æ—¶å­—ç¬¦ä¸²çš„ç”Ÿå‘½å‘¨æœŸå°†è¢«æ‰©å±•, å› ä¸ºå³ä½¿æˆ‘ä»¬å¯¹ `Person` ç±»å‹ä¸€æ— æ‰€çŸ¥, æˆ‘ä»¬ä¹Ÿå¯ä»¥è‚¯å®š, ç”Ÿå‘½å‘¨æœŸæ‰©å±•å¯¹äºç”Ÿæˆå¯¹è±¡ä¹‹åçš„å¯ç”¨æ€§æ˜¯å¿…è¦çš„.

å…³äº `let` è¯­å¥ä¸­å“ªäº›ä¸´æ—¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«å»¶é•¿, [`temporary lifetime extension in Rust Reference`](https://doc.rust-lang.org/stable/reference/destructors.html#temporary-lifetime-extension)ä¸­æœ‰è¯¦ç»†çš„è¯´æ˜, ä½†å®é™…ä¸Šåªé€‚ç”¨äºé‚£äº›ä»è¯­æ³•ä¸Šå°±èƒ½çœ‹å‡ºæœ‰å¿…è¦å»¶é•¿ç”Ÿå‘½å‘¨æœŸçš„è¡¨è¾¾å¼, è€Œä¸ä»»ä½•ç±»å‹ã€å‡½æ•°ç­¾åæˆ–ç‰¹è´¨å®ç°æ— å…³:

```rust
let a = &temporary().field; // Extended!
let a = MyStruct { field: &temporary() }; // Extended!
let a = &MyStruct { field: &temporary() }; // Both extended!
let a = [&temporary()]; // Extended!
let a = { â€¦; &temporary() }; // Extended!

let a = f(&temporary()); // Not extended, because it might not be necessary.
let a = temporary().f(); // Not extended, because it might not be necessary.
let a = temporary() + temporary(); // Not extended, because it might not be necessary.
```

è™½ç„¶è¿™çœ‹èµ·æ¥å¾ˆåˆç†, ä½†å½“æˆ‘ä»¬è€ƒè™‘åˆ°æ„é€ å…ƒç»„ç»“æ„æˆ–å…ƒç»„å˜ä½“çš„è¯­æ³•åªæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶, ç¡®å®ä¼šæ„Ÿåˆ°æ„å¤–: ä»è¯­æ³•ä¸Šè®², `Some(123)` æ˜¯å¯¹å‡½æ•° `Some` çš„å‡½æ•°è°ƒç”¨.

ä¾‹å¦‚:

```rust
let a = Some(&temporary()); // Not extended! (Because `Some` could have any signature...)
let a = Some { 0: &temporary() }; // Extended! (I bet you have never used this syntax.)
```

è¿™å¯èƒ½ä¼šè®©äººç›¸å½“å›°æƒ‘.

è¿™ä¹Ÿæ˜¯å€¼å¾—è€ƒè™‘[é‡æ–°ä¿®è®¢è§„åˆ™](https://smallcultfollowing.com/babysteps/blog/2023/03/15/temporary-lifetimes/#design-principles)çš„åŸå› ä¹‹ä¸€.

### æŒç»­æ¨å¹¿

ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•å¾ˆå®¹æ˜“ä¸å¦ä¸€ç§å«ä¸æ–­æ™‹å‡çš„ä¸œè¥¿æ··æ·†, åè€…æ˜¯ä¸´æ—¶å˜é‡è·å¾—æ¯”é¢„æœŸç”Ÿå‘½å‘¨æœŸé•¿çš„å¦ä¸€ç§æ–¹å¼.

åœ¨`&123`å’Œ`&None`è¿™æ ·çš„è¡¨è¾¾å¼ä¸­, å€¼è¢«è®¤å®šä¸ºå¸¸é‡ï¼ˆ[without interior mutability and without desctructors](https://doc.rust-lang.org/stable/reference/destructors.html#constant-promotion)ï¼‰, å› æ­¤ä¼šè‡ªåŠ¨æ™‹å‡ä¸ºæ°¸ç”Ÿå€¼. è¿™æ„å‘³ç€è¿™äº›å¼•ç”¨å°†å…·æœ‰`'static`ç”Ÿå‘½å‘¨æœŸ.

ä¾‹å¦‚:

```rust
let x = f(&3); // The &3 here is 'static, regardless if that's necessary for `f()`.
```

This even applies to simple expressions:

```rust
let x = f(&(1 + 2)); // The &3 here is 'static.
```

åœ¨åŒæ—¶é€‚ç”¨ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸå»¶é•¿å’Œæ’å®šæå‡çš„æƒ…å†µä¸‹, åè€…ä¼˜å…ˆ, å› ä¸ºå®ƒå»¶é•¿çš„ç”Ÿå‘½å‘¨æœŸæœ€é•¿:

```rust
let x = &1; // constant promotion, not temporary lifetime extension.
```

ä¹Ÿå°±æ˜¯è¯´, åœ¨ä¸Šé¢çš„ä»£ç æ®µä¸­, `x`æ˜¯ä¸€ä¸ª`'static`å¼•ç”¨. å€¼`1`çš„å¯¿å‘½ç”šè‡³æ¯”`x`æœ¬èº«è¿˜é•¿.

### ä»£ç å—ä¸­çš„ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•

æƒ³è±¡ä¸€ä¸‹, æˆ‘ä»¬æœ‰æŸç§`Writer`ç±»å‹, å®ƒæŒæœ‰ä¸€ä¸ªè¦å†™å…¥çš„æ–‡ä»¶çš„å¼•ç”¨:

```rust
pub struct Writer<'a> {
    pub file: &'a File
}
```

ä»¥ä¸‹ä»£ç åˆ›å»ºäº†`Writer`, å†™å…¥æ–°åˆ›å»ºçš„æ–‡ä»¶:

```rust
println!("opening file...");
let filename = "hello.txt";
let file = File::create(filename).unwrap();
let writer = Writer { file: &file };
```

ç°åœ¨çš„ä½œç”¨åŸŸåŒ…å«`filename`ã€`file`å’Œ`writer`. ç„¶è€Œ, åé¢çš„ä»£ç åªèƒ½é€šè¿‡
`Writer`å†™å…¥. ç†æƒ³çš„æƒ…å†µæ˜¯, åœ¨ä½œç”¨åŸŸä¸­å·²ç»çœ‹ä¸åˆ°`filename`, å°¤å…¶æ˜¯`file`.

ç”±äºä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•ä¹Ÿé€‚ç”¨äºä»£ç å—çš„æœ€ç»ˆè¡¨è¾¾å¼, å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®ç°:

```rust
let writer = {
    println!("opening file...");
    let filename = "hello.txt";
    Writer { file: &File::create(filename).unwrap() }
};
```

ç°åœ¨, `Writer`çš„åˆ›å»ºè¢«æ•´é½åœ°å°è£…åœ¨å®ƒè‡ªå·±çš„ä½œç”¨åŸŸä¸­, è¿™æ ·å¤–å±‚ä½œç”¨åŸŸåªèƒ½çœ‹åˆ° `writer`, è€Œçœ‹ä¸åˆ°å…¶ä»–ä»»ä½•ä¸œè¥¿.å¾—ç›Šäºä¸´æ—¶ç”Ÿå‘½å‘¨æœŸçš„æ‰©å±•, åœ¨å†…ä½œç”¨åŸŸä¸­ä½œä¸ºä¸´æ—¶åˆ›å»ºçš„`file`ä¸ `writer` ä¸€æ ·çš„å­˜æ´»æ—¶é—´.

### ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•çš„é™åˆ¶

è¯•æƒ³ä¸€ä¸‹, å¦‚æœæˆ‘ä»¬å°†`Writer`ç»“æ„ä¸­çš„`file`å­—æ®µè®¾ç½®ä¸ºç§æœ‰, ä¼šæ˜¯æ€æ ·çš„ç»“æœï¼Ÿ

```rust
pub struct Writer<'a> {
    file: &'a File
}

impl<'a> Writer<'a> {
    pub fn new(file: &'a File) -> Self {
        Self { file }
    }
}
```

è¿™æ ·, æˆ‘ä»¬å°±ä¸éœ€è¦å¯¹åŸå§‹ç”¨æ³•ç‰‡æ®µåšå¤ªå¤šæ”¹åŠ¨äº†:

```rust
println!("opening file...");
let filename = "hello.txt";
let file = File::create(filename).unwrap();
let writer = Writer::new(&file); // Only this line changed.
```

æˆ‘ä»¬åªéœ€è°ƒç”¨`Writer::new()`è€Œä¸æ˜¯ä½¿ç”¨`Writer {}`è¯­æ³•æ¥æ„å»º.

ä¸è¿‡, è¿™å¯¹ä½œç”¨åŸŸç‰ˆæœ¬æ— æ•ˆ:

```rust
let writer = {
    println!("opening file...");
    let filename = "hello.txt";
    Writer::new(&File::create(filename).unwrap()) // Error: Does not live long enough!
};

writer.something(); // Error: File no longer alive here!
```

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„, è™½ç„¶ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•ä¼šé€šè¿‡`Writer {}`ç»“æ„è¯­æ³•ä¼ æ’­, ä½†ä¸ä¼šé€šè¿‡`Writer::new()`å‡½æ•°è°ƒç”¨è¯­æ³•ä¼ æ’­. (ä¾‹å¦‚, ç­¾åå¯ä»¥æ˜¯`fn new(&File) -> Self<'static>`æˆ–`fn new(&File) -> i32`, è¿™æ ·å°±ä¸éœ€è¦æ‰©å±•ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸäº†).

é—æ†¾çš„æ˜¯, æˆ‘ä»¬æ— æ³•æ˜ç¡®é€‰æ‹©ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•.æˆ‘ä»¬å¿…é¡»åœ¨æœ€å¤–å±‚ä½œç”¨åŸŸä¸­è®¾ç½®ä¸€ä¸ª`let file`.ç›®å‰æˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„åŠæ³•å°±æ˜¯ä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–:

```rust
let file;
let writer = {
    println!("opening file...");
    let filename = "hello.txt";
    file = File::create(filename).unwrap();
    Writer::new(&file)
};
```

ä½†è¿™ä¼šä½¿`file`å›åˆ°ä½œç”¨åŸŸä¸­, è€Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦é¿å…çš„.

è™½ç„¶å¯ä»¥è¯´æŠŠ`let file`æ”¾åœ¨ä½œç”¨åŸŸå¤–éƒ¨å¹¶ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜, ä½†å¯¹äºå¤§å¤šæ•°`Rust`ç¨‹åºå‘˜æ¥è¯´, è¿™ç§å˜é€šæ–¹æ³•å¹¶ä¸æ˜æ˜¾.å»¶è¿Ÿåˆå§‹åŒ–å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„åŠŸèƒ½, ç¼–è¯‘å™¨ç›®å‰åœ¨ç»™å‡ºä¸´æ—¶ç”Ÿå‘½å‘¨æœŸé”™è¯¯æ—¶ä¹Ÿä¸ä¼šå»ºè®®é‡‡ç”¨è¿™ç§å˜é€šæ–¹æ³•. å³ä½¿ç¼–è¯‘å™¨å¯ä»¥è¿™æ ·åš, è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå°æ”¹åŠ¨.

å¦‚æœèƒ½ä»¥æŸç§æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜å°±å¥½äº†

### Macroså®

å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•°æ—¢èƒ½åˆ›å»ºæ–‡ä»¶, åˆèƒ½è¿”å›ä¸€ä¸ª `Writer` æ–‡ä»¶, å¯èƒ½ä¼šå¾ˆæœ‰ç”¨.æ¯”å¦‚

```rust
let writer = Writer::new_file("hello.txt");
```

ä½†æ˜¯, ç”±äº `Writer` åªå€Ÿç”¨`file`, è¿™å°±è¦æ±‚ `new_file` å°†`File`å­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹.å®ƒå¯ä»¥`leak`è¿™ä¸ª`File`æˆ–ä»¥æŸç§æ–¹å¼å°†å…¶å­˜å‚¨åœ¨`static`ä¸­, ä½†(ç›®å‰)å®ƒæ²¡æœ‰åŠæ³•è®©`file`ä¸è¿”å›çš„ `Writer` ä¸€æ ·é•¿å­˜.

å› æ­¤, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®æ¥å®šä¹‰æ–‡ä»¶å’Œå†™å…¥å™¨, æ— è®ºå®ƒåœ¨å“ªé‡Œè¢«è°ƒç”¨:

```rust
macro_rules! let_writer_to_file {
    ($writer:ident, $filename:expr) => {
        let file = std::fs::File::create($filename).unwrap();
        let $writer = Writer::new(&file);
    };
}
```

ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:

```rust
let_writer_to_file!(writer, "hello.txt");

writer.something();
```

ç”±äº[å®çš„å«ç”Ÿæ€§](https://veykril.github.io/tlborm/decl-macros/minutiae/hygiene.html), åœ¨æ­¤èŒƒå›´å†…æ— æ³•è®¿é—®`file`.

è¿™æ ·åšæ˜¯å¯è¡Œçš„, ä½†å¦‚æœå®ƒçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªæ™®é€šçš„å‡½æ•°è°ƒç”¨, ä¸æ˜¯æ›´å¥½å—ï¼Ÿ

```rust
et writer = writer_to_file!("hello.txt");

writer.something();
```

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è§, åœ¨ `let writer = ...;`è¯­å¥ä¸­åˆ›å»ºä¸€ä¸ªå­˜æ´»æ—¶é—´è¶³å¤Ÿé•¿çš„ä¸´æ—¶`File`çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•:

```rust
macro_rules! writer_to_file {
    ($filename:expr) => {
        Writer { file: &File::create($filename).unwrap() }
    };
}

let writer = writer_to_file!("hello.txt");
```

è¿™å°†æ‰©å±•æˆ:

```rust
let writer = Writer { file: &File::create("hello.txt").unwrap() };
```

è¿™å°†åœ¨å¿…è¦æ—¶å»¶é•¿ä¸´æ—¶`File`çš„ç”Ÿå‘½å‘¨æœŸ.

ä½†å¦‚æœ`file`ä¸æ˜¯å…¬å¼€, æˆ‘ä»¬å°±ä¸èƒ½è¿™æ ·åš, è€Œéœ€è¦ä½¿ç”¨ `Writer::new()` ä»£æ›¿.å®éœ€è¦åœ¨è°ƒç”¨å®ƒçš„ `let writer = ...;`è¯­å¥ä¹‹å‰æ’å…¥ `let file`;.è¿™æ˜¯ä¸å¯èƒ½çš„.

#### format_args!()

è¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯(ç°åœ¨)`format_args!()` çš„ç»“æœä¸èƒ½å­˜å‚¨åœ¨ `let` è¯­å¥ä¸­çš„åŸå› :

```rust
let f = format_args!("{}", 1); // Error!
something.write_fmt(f);
```

åŸå› æ˜¯ `format_args!()` ä¼šæ‰©å±•ä¸ºç±»ä¼¼ `fmt::Arguments::new(&Argument::display(&arg), ...)` çš„å†…å®¹, å…¶ä¸­ä¸€äº›å‚æ•°æ˜¯å¯¹ä¸´æ—¶å˜é‡çš„å¼•ç”¨.

ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•ä¸é€‚ç”¨äºå‡½æ•°è°ƒç”¨çš„å‚æ•°, å› æ­¤ `fmt::Arguments` å¯¹è±¡åªèƒ½åœ¨åŒä¸€è¯­å¥ä¸­ä½¿ç”¨.

#### pin!()

å¦ä¸€ç§ç»å¸¸é€šè¿‡å®åˆ›å»ºçš„ç±»å‹æ˜¯ `Pin`.ç²—ç•¥åœ°è¯´, å®ƒè¡¨ç¤ºå¯¹æŸä¸ªæ°¸è¿œä¸ä¼šç§»åŠ¨çš„ä¸œè¥¿çš„å¼•ç”¨.(å…·ä½“ç»†èŠ‚å¾ˆå¤æ‚, ä½†ç°åœ¨ä¸æ˜¯å¾ˆé‡è¦).

å®ƒæ˜¯é€šè¿‡ä¸€ä¸ªåä¸º `Pin::new_unchecked` çš„`unsafe`å‡½æ•°åˆ›å»ºçš„, å› ä¸ºæˆ‘ä»¬éœ€è¦ä¿è¯å®ƒæ‰€å¼•ç”¨çš„å€¼å³ä½¿åœ¨ `Pin` æœ¬èº«æ¶ˆå¤±åä¹Ÿä¸ä¼šè¢«ç§»åŠ¨.

ä½¿ç”¨è¯¥å‡½æ•°çš„æœ€ä½³æ–¹æ³•æ˜¯ä½¿ç”¨[`shadowing`](https://doc.rust-lang.org/rust-by-example/variable_bindings/scope.html):

```rust
let mut thing = Thing { â€¦ };
let thing = unsafe { Pin::new_unchecked(&mut thing) };
```

å› ä¸ºç¬¬äºŒä¸ª`thing`ä¼šå¯¹ç¬¬ä¸€ä¸ª`thing`äº§ç”Ÿ`shadow`, æ‰€ä»¥ç¬¬ä¸€ä¸ª`thing`(ä»ç„¶å­˜åœ¨)ä¸èƒ½å†è¢«å‘½å.å› ä¸ºå®ƒä¸èƒ½è¢«å‘½å, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¡®å®šå®ƒä¸èƒ½è¢«ç§»åŠ¨(å³ä½¿åœ¨æ”¾å¼ƒç¬¬äºŒä¸ª`thing`å), è¿™æ­£æ˜¯æˆ‘ä»¬åœ¨`unsafe`å—ä¸­æ‰€æ‰¿è¯ºçš„.

å› ä¸ºè¿™æ˜¯ä¸€ç§å¸¸è§çš„æ¨¡å¼, æ‰€ä»¥é€šå¸¸ç”¨å®æ¥æ•è·è¿™ç§æ¨¡å¼.

ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª `let_pin` å®å¦‚ä¸‹:

```rust
macro_rules! let_pin {
    ($name:ident, $init:expr) => {
        let mut $name = $init;
        let $name = unsafe { Pin::new_unchecked(&mut $name) };
    };
}
```

ä½¿ç”¨æ–¹æ³•ä¸ä¹‹å‰çš„ `let_writer_to_file` å®ç±»ä¼¼:

```rust
let_pin!(thing, Thing { â€¦ });

thing.something();
```

è¿™æ ·åšå¯ä»¥å¾ˆå¥½åœ°å°è£…å’Œéšè—ä¸å®‰å…¨ä»£ç .

ä½†æ˜¯, å°±åƒæˆ‘ä»¬çš„ `Writer` ç¤ºä¾‹ä¸€æ ·, å¦‚æœå®ƒèƒ½åƒä¸‹é¢è¿™æ ·å·¥ä½œ, ä¸æ˜¯æ›´å¥½å—ï¼Ÿ

```rust
let thing = pin!(Thing { â€¦ });
```

æˆ‘ä»¬éƒ½çŸ¥é“, è¦åšåˆ°è¿™ä¸€ç‚¹, æˆ‘ä»¬å¿…é¡»åˆ©ç”¨ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•åŠŸèƒ½, ä½¿`Thing`çš„ç”Ÿå‘½å‘¨æœŸè¶³å¤Ÿé•¿.è€Œè¦åšåˆ°è¿™ä¸€ç‚¹, æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ `Pin {}` è¯­æ³•æ¥æ„é€  `Pin:Pin { pinned: &mut Thing { ... }}` ä¼šè°ƒç”¨ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸæ‰©å±•, ä½† P`in::new_unchecked(&mut Thing { ... })` ä¸ä¼š.

è¿™å°±æ„å‘³ç€è¦å°† `Pin` çš„å­—æ®µå…¬å¼€, è¿™å°±è¿èƒŒäº† `Pin` çš„åˆè¡·.åªæœ‰åœ¨å­—æ®µæ˜¯ç§æœ‰çš„æƒ…å†µä¸‹, å®ƒæ‰èƒ½æä¾›æœ‰æ„ä¹‰çš„ä¿è¯.

è¿™æ„å‘³ç€, ä¸å¹¸çš„æ˜¯, (å¦‚ä»Š)ä¸å¯èƒ½è‡ªå·±ç¼–å†™è¿™æ ·ä¸€ä¸ª `pin!()` å®.

æ ‡å‡†åº“è¿˜æ˜¯è¿™ä¹ˆåšäº†, çŠ¯äº†ä¸€ä¸ªå¯æ€•çš„ç½ªè¡Œ:`Pin` çš„ "ç§æœ‰ "å­—æ®µå®é™…ä¸Šè¢«å®šä¹‰ä¸º `pub`, ä½†ä¹Ÿè¢«æ ‡è®°ä¸º "ä¸ç¨³å®š", å¦‚æœä½ è¯•å›¾ä½¿ç”¨å®ƒ, ç¼–è¯‘å™¨å°±ä¼šæŠ±æ€¨.

å¦‚æœä¸éœ€è¦è¿™ç§é»‘å®¢æ‰‹æ®µå°±å¥½äº†.

## `super let`

### ç”¨æˆ·ä½“éªŒå’Œè¯Šæ–­

### å¯èƒ½çš„æ‰©å±•

æœªæ¥å¯èƒ½çš„æ‰©å±•æ˜¯å…è®¸åœ¨å‡½æ•°ä½œç”¨åŸŸä¸­ä½¿ç”¨`super let`. ä¹Ÿå°±æ˜¯è¯´, "super"æŒ‡çš„æ˜¯å‡½æ•°çš„è°ƒç”¨è€….

æ­£å¦‚[@lorepozo@tech.lgbt](https://hachyderm.io/@lorepozo@tech.lgbt/111499621692587962)åœ¨Mastodonä¸Šæåˆ°çš„, è¿™å°†ä½¿ `pin!()` æˆä¸ºä¸€ä¸ªå‡½æ•°è€Œä¸æ˜¯å®. åŒæ ·, å®ƒä¹Ÿèƒ½è®© `Writer::new_file(...)` æˆä¸ºå¯èƒ½, è€Œä¸å¿…ä½¿ç”¨å®.

è¿™æ ·åšçš„æœ‰æ•ˆæ–¹å¼æ˜¯å…è®¸æŸäº›å‡½æ•°å°†å¯¹è±¡æ”¾å…¥è°ƒç”¨è€…çš„å †æ ˆæ¡†æ¶ä¸­, ç„¶åå¯ä»¥ä»è¿”å›å€¼ä¸­å¼•ç”¨è¿™äº›å¯¹è±¡. è¿™åœ¨ä»»ä½•æ™®é€šçš„æ—§å‡½æ•°ä¸­éƒ½æ˜¯è¡Œä¸é€šçš„ï¼›é€šå¸¸æƒ…å†µä¸‹, è°ƒç”¨è€…ä¸ä¼šä¸ºå‡½æ•°é¢„ç•™æ”¾ç½®å¯¹è±¡çš„ç©ºé—´. è¿™éœ€è¦æˆä¸ºå‡½æ•°ç­¾åçš„ä¸€éƒ¨åˆ†.

ä¹Ÿè®¸å¯ä»¥è¿™æ ·?

```rust
pub placing fn new_file(filename: &str) -> Writer {
    super let mut file = File::create(filename).unwrap(); // Placed into caller's stack frame
    Writer::new(&file) // So we can borrow it in the return value!
}
```

è¿™ä¸æ˜¯æˆ‘ç°åœ¨æå‡ºçš„å»ºè®®çš„ä¸€éƒ¨åˆ†, ä½†æƒ³æƒ³ä¹Ÿå¾ˆæœ‰è¶£. ï¼‰

## ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸ 2024 RFC

å‡ ä¸ªæœˆå‰, æˆ‘ä¸*Niko Matsakis*å’Œ*Ding Xiang Fei*åˆ†äº«äº†æˆ‘çš„æƒ³æ³•--`super let`.ä»–ä»¬ä¸€ç›´åœ¨åŠªåŠ›åˆ¶å®š`super let`çš„ç¡®åˆ‡å®šä¹‰å’Œè¯¦ç»†è§„åˆ™, ä»¥åŠä¸‹ä¸€ç‰ˆ`Rust`çš„ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸçš„ä¸€äº›æ–°è§„åˆ™.

è¿™é¡¹åä¸º [`â€œtemporary lifetimes 2024â€ effort`](https://rust-lang.zulipchat.com/#narrow/stream/403629-t-lang.2Ftemporary-lifetimes-2024)çš„è”åˆå·¥ä½œæ­£åœ¨ä¿ƒæˆä¸€é¡¹RFC, è¯¥RFCä¸»è¦å»ºè®®å°½å¯èƒ½å‡å°‘ä¸´æ—¶ç”Ÿå‘½å‘¨æœŸ, ä»¥é˜²æ­¢ `if let` æˆ–åŒ¹é…ä¸­çš„ä¸´æ—¶ `MutexGuard` å¯¼è‡´çš„æ­»é”, å¹¶æ·»åŠ  `super let` ä½œä¸ºé€‰æ‹©æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„ä¸€ç§æ–¹å¼.

## åé¦ˆ

ä½ æ˜¯å¦æœ‰æ„è¯†åœ°ä½¿ç”¨è¿‡ä¸´æ—¶å»¶é•¿å¯¿å‘½çš„æ–¹æ³•ï¼Ÿæˆ–è€…ä½ è¢«å®ƒå’¬è¿‡å—ï¼Ÿ

ä½ æ€ä¹ˆçœ‹`super let`ï¼Ÿä½ ä¼šä½¿ç”¨å®ƒå—ï¼Ÿæˆ–è€…ä½ æœ‰æ›´å¥½çš„ä¸»æ„ï¼Ÿ

è¯·åœ¨ä¸‹é¢çš„è¯„è®ºæˆ– `GitHub` ä¸Šå‘Šè¯‰æˆ‘, æˆ–åŠ å…¥ `Reddit``ã€Twitter` æˆ– `Mastodon` ä¸Šçš„è®¨è®º.

## å¼•ç”¨

[^1]: [Rust Temporary Lifetimes and "Super Let"](https://blog.m-ou.se/super-let/)
